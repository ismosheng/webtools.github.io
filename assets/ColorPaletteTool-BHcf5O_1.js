import{_ as ye,q as ke,f as S,e as b,c as le,s as N,r as T,o as c,w as y,a as g,b as l,j as P,i as m,d as $,t as h,v as Ce,x as Me,F as V,y as W,n as j,z as we,T as $e}from"./index-CKlJhNh4.js";import{T as Te}from"./ToolHeader-CSAKN2xS.js";const Fe={class:"color-tool__body"},He={class:"color-panel"},ze={class:"panel-header"},De={class:"panel-actions"},Ie={key:0,class:"upload-hint"},Be={key:1,class:"image-preview"},Se=["src"],Pe={key:1,class:"meta-grid"},Re={class:"meta-item"},Le={class:"meta-item"},qe={class:"meta-item"},Ee={class:"manual-card"},Ne={class:"manual-controls"},Ve={class:"color-panel"},We={class:"panel-header"},je={key:0,class:"palette-grid"},Xe=["onClick"],Ae={class:"color-chip__info"},Ge={key:1,class:"empty-state"},Ue={class:"color-panel"},Oe={key:0,class:"color-detail"},Je={class:"color-detail__values"},Ke={key:1,class:"empty-state"},Ze={key:2,class:"tone-scale"},Qe={key:0,class:"copy-hint"},Ye=8*1024*1024,et={__name:"ColorPaletteTool",setup(tt){const{isDark:X}=ke(),ae=S(()=>({"tool-wrapper":!0,"tool-wrapper--dark":X.value,"tool-wrapper--light":!X.value})),A=b(null),k=b(""),f=b(null),_=b([]),d=b(null),F=b(!1),C=b(""),H=b(""),M=b("#3B82F6");let R=null;const ne=()=>{A.value?.click()},se=t=>{t.preventDefault(),F.value=!0},oe=t=>{t.preventDefault(),F.value=!1},re=t=>{t.preventDefault(),F.value=!1;const e=t.dataTransfer?.files?.[0];G(e)},ie=t=>{const e=t.target.files?.[0];G(e),t.target.value=""},G=t=>{if(C.value="",!t)return;if(!t.type.startsWith("image/")){C.value="仅支持上传图片文件";return}if(t.size>Ye){C.value="图片体积请控制在 8MB 以内";return}const e=new FileReader;e.onload=()=>{k.value=e.result,_.value=[],d.value=null,f.value={name:t.name,size:ve(t.size)}},e.readAsDataURL(t)},ue=t=>{const e=t.target;f.value={...f.value||{},width:e.naturalWidth,height:e.naturalHeight},_.value=ce(e),d.value=_.value[0]||L(M.value)},ce=(t,e=8,n=6)=>{const o=document.createElement("canvas"),s=o.getContext("2d",{willReadFrequently:!0});if(!s)return[];const r=320,i=t.naturalWidth/t.naturalHeight||1,a=Math.min(r,t.naturalWidth),u=Math.max(1,Math.round(a/i));o.width=a,o.height=u,s.drawImage(t,0,0,a,u);const{data:p}=s.getImageData(0,0,a,u),x=new Map;let w=0;for(let v=0;v<p.length;v+=4*n){if(p[v+3]<140)continue;const D=p[v],I=p[v+1],te=p[v+2],E=de(D,I,te);w+=1,x.has(E)||x.set(E,{r:0,g:0,b:0,count:0});const B=x.get(E);B.r+=D,B.g+=I,B.b+=te,B.count+=1}return Array.from(x.values()).map(v=>{const z=Math.round(v.r/v.count),D=Math.round(v.g/v.count),I=Math.round(v.b/v.count);return U(z,D,I,v.count/(w||1))}).sort((v,z)=>z.ratio-v.ratio).slice(0,e)},de=(t,e,n)=>{const s=Math.min(255,Math.round(t/24)*24),r=Math.min(255,Math.round(e/24)*24),i=Math.min(255,Math.round(n/24)*24);return`${s}-${r}-${i}`},ve=t=>t<1024?`${t}B`:t<1024*1024?`${(t/1024).toFixed(1)}KB`:`${(t/(1024*1024)).toFixed(2)}MB`,U=(t,e,n,o=0)=>{const s=O(t,e,n),r=me(t,e,n);return{hex:s,rgb:`rgb(${t}, ${e}, ${n})`,hsl:ge(r),ratio:+(o*100).toFixed(1),r:t,g:e,b:n,hslRaw:r}},O=(t,e,n)=>{const o=s=>s.toString(16).padStart(2,"0");return`#${o(t)}${o(e)}${o(n)}`.toUpperCase()},pe=t=>{let e=t.trim().replace("#","");if(e.length===3&&(e=e.split("").map(r=>r+r).join("")),e.length!==6)return null;const n=parseInt(e.slice(0,2),16),o=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);return[n,o,s].some(r=>Number.isNaN(r))?null:{r:n,g:o,b:s}},me=(t,e,n)=>{const o=t/255,s=e/255,r=n/255,i=Math.max(o,s,r),a=Math.min(o,s,r),u=i-a;let p=0,x=0;const w=(i+a)/2;if(u!==0){switch(x=u/(1-Math.abs(2*w-1)),i){case o:p=(s-r)/u%6;break;case s:p=(r-o)/u+2;break;default:p=(o-s)/u+4}p*=60,p<0&&(p+=360)}return{h:p,s:x,l:w}},he=(t,e,n)=>{const o=(1-Math.abs(2*n-1))*e,s=o*(1-Math.abs(t/60%2-1)),r=n-o/2;let i=0,a=0,u=0;t>=0&&t<60?(i=o,a=s):t<120?(i=s,a=o):t<180?(a=o,u=s):t<240?(a=s,u=o):t<300?(i=s,u=o):(i=o,u=s);const p=Math.round((i+r)*255),x=Math.round((a+r)*255),w=Math.round((u+r)*255);return{r:p,g:x,b:w}},ge=({h:t,s:e,l:n})=>`hsl(${Math.round(t)}, ${(e*100).toFixed(1)}%, ${(n*100).toFixed(1)}%)`,L=t=>{const e=pe(t);return e?U(e.r,e.g,e.b,0):null},J=S(()=>{if(!d.value)return[];const{h:t,s:e,l:n}=d.value.hslRaw;return[-.25,-.15,-.08,.08,.18,.28].map(s=>{const r=fe(n+s,0,1),i=he(t,e,r);return{hex:O(i.r,i.g,i.b),label:`${s>0?"+":""}${Math.round(s*100)}%`}}).filter(s=>s.hex!==d.value.hex)}),fe=(t,e,n)=>Math.min(Math.max(t,e),n),_e=S(()=>d.value?[{label:"HEX",value:d.value.hex},{label:"RGB",value:d.value.rgb},{label:"HSL",value:d.value.hsl}]:[]),K=S(()=>_.value.length?_.value.map((t,e)=>`${e+1}. ${t.hex} (${t.rgb}) ${t.ratio?`${t.ratio}%`:""}`.trim()).join(`
`):""),Z=async(t,e)=>{if(t)try{await navigator.clipboard.writeText(t),H.value=e,R&&clearTimeout(R),R=setTimeout(()=>{H.value=""},2e3)}catch(n){console.error(n)}},Q=t=>{Z(t,`已复制 ${t}`)},xe=()=>{K.value&&Z(K.value,"已复制完整调色板")},q=()=>{const t=L(M.value);if(!t){C.value="请输入合法的 HEX 颜色";return}C.value="",d.value=t},be=()=>{k.value="",_.value=[],d.value=L(M.value),f.value=null},Y=["https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=900&q=80","https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?auto=format&fit=crop&w=900&q=80"],ee=(t=0)=>{k.value=Y[t%Y.length],_.value=[],d.value=null,f.value={name:"示例图片",size:"—"}};return(t,e)=>{const n=T("v-btn"),o=T("v-icon"),s=T("v-alert"),r=T("v-text-field"),i=T("v-sheet");return c(),le(i,{class:N(ae.value),rounded:"xl",elevation:"0"},{default:y(()=>[g(Te,{icon:"mdi-palette-outline",color:"deep-orange",title:"调色与提取",description:"上传或选择示例图片，自动提取主色、复制色值并生成多阶明暗色板。"}),l("div",Fe,[l("section",He,[l("div",ze,[e[7]||(e[7]=l("div",null,[l("div",{class:"panel-title"},"图片源"),l("div",{class:"panel-subtitle"},"拖拽或点击上传，支持 JPG / PNG / WebP")],-1)),l("div",De,[g(n,{variant:"text",size:"small",onClick:e[0]||(e[0]=a=>ee())},{default:y(()=>[...e[4]||(e[4]=[$("示例一",-1)])]),_:1}),g(n,{variant:"text",size:"small",onClick:e[1]||(e[1]=a=>ee(1))},{default:y(()=>[...e[5]||(e[5]=[$("示例二",-1)])]),_:1}),g(n,{variant:"text",size:"small",color:"grey",disabled:!k.value,onClick:be},{default:y(()=>[...e[6]||(e[6]=[$(" 清除 ",-1)])]),_:1},8,["disabled"])])]),l("div",{class:N(["upload-area",{"upload-area--active":F.value,"upload-area--loaded":k.value}]),onClick:ne,onDragover:se,onDragleave:oe,onDrop:re},[l("input",{ref_key:"fileInputRef",ref:A,class:"upload-input",type:"file",accept:"image/*",onChange:ie},null,544),k.value?(c(),m("div",Be,[l("img",{src:k.value,alt:"色板来源图片",onLoad:ue},null,40,Se)])):(c(),m("div",Ie,[g(o,{icon:"mdi-cloud-upload-outline",size:"40"}),e[8]||(e[8]=l("p",null,"拖放图片到此处或点击上传",-1)),e[9]||(e[9]=l("small",null,"建议尺寸 ≥ 600px，文件小于 8MB",-1))]))],34),C.value?(c(),le(s,{key:0,type:"error",density:"compact",variant:"tonal",class:"mt-4"},{default:y(()=>[$(h(C.value),1)]),_:1})):P("",!0),f.value?(c(),m("div",Pe,[l("div",Re,[e[10]||(e[10]=l("span",null,"文件名",-1)),l("strong",null,h(f.value.name),1)]),l("div",Le,[e[11]||(e[11]=l("span",null,"尺寸",-1)),l("strong",null,h(f.value.width||"—")+" × "+h(f.value.height||"—"),1)]),l("div",qe,[e[12]||(e[12]=l("span",null,"体积",-1)),l("strong",null,h(f.value.size),1)])])):P("",!0),l("div",Ee,[e[14]||(e[14]=l("div",{class:"panel-title"},"自定义取色",-1)),l("div",Ne,[Ce(l("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>M.value=a),type:"color",class:"color-picker",title:"选择颜色",onInput:q},null,544),[[Me,M.value]]),g(r,{modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=a=>M.value=a),label:"HEX 色值",variant:"outlined",density:"comfortable","hide-details":"",maxlength:"7",onChange:q},null,8,["modelValue"]),g(n,{color:"primary",variant:"flat",onClick:q},{default:y(()=>[...e[13]||(e[13]=[$("应用",-1)])]),_:1})])])]),l("section",Ve,[l("div",We,[e[16]||(e[16]=l("div",null,[l("div",{class:"panel-title"},"主色板"),l("div",{class:"panel-subtitle"}," 自动提取最多 8 种占比最高的颜色，支持一键复制 ")],-1)),g(n,{variant:"text",size:"small",disabled:!_.value.length,"prepend-icon":"mdi-content-copy",onClick:xe},{default:y(()=>[...e[15]||(e[15]=[$(" 复制色板 ",-1)])]),_:1},8,["disabled"])]),_.value.length?(c(),m("div",je,[(c(!0),m(V,null,W(_.value,a=>(c(),m("button",{key:a.hex,class:N(["color-chip",{"color-chip--active":d.value?.hex===a.hex}]),onClick:u=>d.value=a},[l("span",{class:"color-chip__swatch",style:j({backgroundColor:a.hex})},null,4),l("div",Ae,[l("strong",null,h(a.hex),1),l("span",null,h(a.ratio)+"%",1),l("small",null,h(a.rgb),1)]),g(n,{variant:"text",size:"x-small",icon:"mdi-content-copy",onClick:we(u=>Q(a.hex),["stop"])},null,8,["onClick"])],10,Xe))),128))])):(c(),m("div",Ge," 上传图片后即可自动提取色板，可结合自定义取色进行品牌色探索。 "))]),l("section",Ue,[e[17]||(e[17]=l("div",{class:"panel-header"},[l("div",null,[l("div",{class:"panel-title"},"色值详情与明暗阶"),l("div",{class:"panel-subtitle"},"查看 HEX / RGB / HSL 并生成梯度色板")])],-1)),d.value?(c(),m("div",Oe,[l("div",{class:"color-detail__swatch",style:j({backgroundColor:d.value.hex})},null,4),l("div",Je,[(c(!0),m(V,null,W(_e.value,a=>(c(),m("div",{key:a.label,class:"detail-row"},[l("span",null,h(a.label),1),l("strong",null,h(a.value),1),g(n,{variant:"text",size:"x-small",icon:"mdi-content-copy",onClick:u=>Q(a.value)},null,8,["onClick"])]))),128))])])):(c(),m("div",Ke,"先选择一枚色块或自定义颜色。")),J.value.length?(c(),m("div",Ze,[(c(!0),m(V,null,W(J.value,a=>(c(),m("div",{key:a.hex,class:"tone-scale__item",style:j({backgroundColor:a.hex})},[l("span",null,h(a.label),1),l("strong",null,h(a.hex),1)],4))),128))])):P("",!0)])]),g($e,{name:"fade"},{default:y(()=>[H.value?(c(),m("div",Qe,[g(o,{icon:"mdi-check",size:"16"}),l("span",null,h(H.value),1)])):P("",!0)]),_:1})]),_:1},8,["class"])}}},nt=ye(et,[["__scopeId","data-v-354ab012"]]);export{nt as default};
