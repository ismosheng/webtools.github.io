import{T as ve}from"./ToolHeader-CSAKN2xS.js";import{_ as de,e as s,f as C,g as $,h as I,c as ce,w as k,r as g,o as T,a as o,b as a,i as z,j as O,t as _,n as P,d as L}from"./index-CKlJhNh4.js";const re={class:"tool-body"},me={class:"upload-section"},pe={class:"upload-group"},fe={key:0,class:"file-info"},_e={class:"file-size"},ge={class:"upload-group"},he={key:0,class:"file-info"},be={class:"file-size"},ye={key:0,class:"preview-section"},ke={class:"video-container"},we=["src"],xe=["src"],Ue={class:"video-controls-overlay"},Te={key:1,class:"timeline-section"},Le={class:"timeline-header"},Re={class:"time-display"},Ve={class:"timeline-track video-track"},Me={class:"audio-track-handle"},ze={key:2,class:"settings-section"},Oe={class:"settings-content"},De={class:"setting-item"},je={class:"setting-label"},Ae={class:"setting-control"},Ee={class:"volume-value"},Xe={class:"setting-item"},Ce={class:"setting-label"},Se={class:"setting-control"},Be={class:"setting-value"},Fe={class:"setting-item"},Ne={class:"setting-label"},$e={class:"setting-control"},Ie={class:"setting-value"},Pe={class:"setting-item"},Ge={class:"setting-label"},We={class:"setting-control"},He={class:"action-section"},qe={__name:"VideoAudioTool",setup(Je){const m=s(null),p=s(null),u=s(""),i=s(""),v=s(null),t=s(null),h=s(!1),w=s(0),A=s(0),f=s(0),c=s(0),x=s(100),D=s(0),j=s(0);s(!1);const U=s(!1),R=s(0);s(0);const b=s(!1),E=s(0),X=s(0),d=C(()=>Math.max(A.value,f.value+c.value)),G=C(()=>c.value);C(()=>c.value+f.value);const S=e=>{if(!e||isNaN(e))return"00:00";const l=Math.floor(e/60),n=Math.floor(e%60);return`${String(l).padStart(2,"0")}:${String(n).padStart(2,"0")}`},W=e=>{const l=Array.isArray(e)?e[0]:e;if(!l){m.value=null,u.value&&(URL.revokeObjectURL(u.value),u.value="");return}if(!l.type.startsWith("video/")){alert("请上传视频文件"),m.value=null;return}m.value=l,u.value&&URL.revokeObjectURL(u.value),u.value=URL.createObjectURL(l),v.value&&(v.value.onloadedmetadata=()=>{A.value=v.value.duration})},H=e=>{const l=Array.isArray(e)?e[0]:e;if(!l){p.value=null,i.value&&(URL.revokeObjectURL(i.value),i.value="");return}if(!l.type.startsWith("audio/")){alert("请上传音频文件"),p.value=null;return}p.value=l,i.value&&URL.revokeObjectURL(i.value),i.value=URL.createObjectURL(l),t.value&&(t.value.onloadedmetadata=()=>{f.value=t.value.duration})},q=async()=>{if(!(!v.value||!u.value))if(h.value)v.value.pause(),t.value&&t.value.pause(),h.value=!1;else try{if(await v.value.play(),t.value&&i.value){const e=Math.max(0,w.value-c.value);e>=0&&e<=f.value&&(t.value.currentTime=e,t.value.volume=x.value/100,await t.value.play())}h.value=!0}catch(e){console.error("播放失败:",e),h.value=!1}},B=e=>{if(v.value&&(v.value.currentTime=e,w.value=e,t.value&&i.value)){const l=e-c.value;l>=0&&l<=f.value?t.value.currentTime=l:t.value.pause()}},J=()=>{if(v.value&&(w.value=v.value.currentTime,t.value&&i.value&&h.value)){const e=w.value-c.value;e>=0&&e<=f.value?(Math.abs(t.value.currentTime-e)>.3&&(t.value.currentTime=e),t.value.paused&&t.value.play().catch(()=>{})):t.value.paused||t.value.pause()}},K=e=>{if(!d.value)return;b.value=!0,E.value=e.clientX,X.value=c.value;const l=e.currentTarget.getBoundingClientRect(),y=(e.clientX-l.left)/l.width*d.value;B(y)},Q=e=>{if(!b.value||!d.value)return;const l=e.currentTarget.getBoundingClientRect(),y=(e.clientX-l.left)/l.width*d.value;B(Math.max(0,Math.min(y,d.value)))},Y=()=>{b.value=!1},Z=e=>{e.preventDefault(),b.value=!0,E.value=e.clientX,X.value=c.value},ee=e=>{if(!b.value||!d.value)return;const l=e.clientX-E.value,n=e.currentTarget.closest(".timeline-container");if(!n)return;const y=n.getBoundingClientRect(),V=l/y.width*d.value,M=X.value+V;c.value=Math.max(0,Math.min(M,d.value-f.value))},le=()=>{b.value=!1};$(x,e=>{t.value&&(t.value.volume=e/100)});const ae=async()=>{if(!m.value||!p.value){alert("请先上传视频和音频文件");return}U.value=!0,R.value=0;try{alert(`视频合成功能需要后端支持。

当前功能：
- 预览视频和音频同步播放
- 时间轴调整
- 淡入淡出设置

实际导出需要服务器端视频处理服务。`);const e=setInterval(()=>{R.value+=10,R.value>=100&&(clearInterval(e),U.value=!1,R.value=0)},200)}catch(e){console.error("导出失败:",e),alert("导出失败，请稍后重试"),U.value=!1}},te=()=>{u.value&&URL.revokeObjectURL(u.value),i.value&&URL.revokeObjectURL(i.value),m.value=null,p.value=null,u.value="",i.value="",w.value=0,c.value=0,x.value=100,D.value=0,j.value=0,h.value=!1,v.value&&(v.value.pause(),v.value.currentTime=0),t.value&&(t.value.pause(),t.value.currentTime=0)};$(()=>v.value?.ended,e=>{e&&(h.value=!1,t.value&&t.value.pause())}),I(()=>{u.value&&URL.revokeObjectURL(u.value),i.value&&URL.revokeObjectURL(i.value)});const F=e=>{b.value&&(Q(e),ee(e))},N=()=>{b.value&&(Y(),le())};return typeof window<"u"&&(window.addEventListener("mousemove",F),window.addEventListener("mouseup",N)),I(()=>{typeof window<"u"&&(window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",N))}),(e,l)=>{const n=g("v-icon"),y=g("v-file-input"),V=g("v-btn"),M=g("v-slider"),oe=g("v-text-field"),se=g("v-expansion-panel-text"),ne=g("v-expansion-panel"),ie=g("v-expansion-panels"),ue=g("v-sheet");return T(),ce(ue,{class:"tool-wrapper",rounded:"xl",elevation:"0"},{default:k(()=>[o(ve,{icon:"mdi-music-note-plus",color:"purple",title:"视频添加音频",description:"拖拽音轨、设置淡入淡出，一键同步输出成品。"}),a("div",re,[a("div",me,[a("div",pe,[o(y,{"model-value":m.value,label:"上传视频","prepend-icon":"mdi-video",variant:"outlined",density:"comfortable",accept:"video/*","hide-details":"","onUpdate:modelValue":W},{"prepend-inner":k(()=>[o(n,{icon:"mdi-video",color:"purple"})]),_:1},8,["model-value"]),m.value?(T(),z("div",fe,[o(n,{icon:"mdi-check-circle",color:"success",size:"16"}),a("span",null,_(m.value.name),1),a("span",_e,_((m.value.size/1024/1024).toFixed(2))+" MB",1)])):O("",!0)]),a("div",ge,[o(y,{"model-value":p.value,label:"上传音频","prepend-icon":"mdi-music",variant:"outlined",density:"comfortable",accept:"audio/*","hide-details":"","onUpdate:modelValue":H},{"prepend-inner":k(()=>[o(n,{icon:"mdi-music",color:"purple"})]),_:1},8,["model-value"]),p.value?(T(),z("div",he,[o(n,{icon:"mdi-check-circle",color:"success",size:"16"}),a("span",null,_(p.value.name),1),a("span",be,_((p.value.size/1024/1024).toFixed(2))+" MB",1)])):O("",!0)])]),u.value?(T(),z("div",ye,[a("div",ke,[a("video",{ref_key:"videoElement",ref:v,src:u.value,class:"preview-video",onTimeupdate:J,onLoadedmetadata:l[0]||(l[0]=r=>A.value=r.target.duration),muted:""},null,40,we),a("audio",{ref_key:"audioElement",ref:t,src:i.value,class:"preview-audio",onLoadedmetadata:l[1]||(l[1]=r=>f.value=r.target.duration)},null,40,xe),a("div",Ue,[o(V,{icon:h.value?"mdi-pause":"mdi-play",color:"white",size:"large",variant:"flat",class:"play-btn",onClick:q},null,8,["icon"])])])])):O("",!0),u.value&&i.value?(T(),z("div",Te,[a("div",Le,[a("div",Re,[a("span",null,_(S(w.value)),1),l[6]||(l[6]=a("span",{class:"time-separator"},"/",-1)),a("span",null,_(S(d.value)),1)])]),a("div",{class:"timeline-container",onMousedown:K},[a("div",Ve,[a("div",{class:"timeline-progress",style:P({width:`${w.value/d.value*100}%`})},null,4),l[7]||(l[7]=a("div",{class:"timeline-label"},"视频",-1))]),a("div",{class:"timeline-track audio-track",style:P({left:`${G.value/d.value*100}%`,width:`${f.value/d.value*100}%`}),onMousedown:Z},[a("div",Me,[o(n,{icon:"mdi-drag",size:"16"})]),l[8]||(l[8]=a("div",{class:"timeline-label"},"音频",-1))],36)],32)])):O("",!0),u.value&&i.value?(T(),z("div",ze,[o(ie,{variant:"accordion",class:"settings-panels"},{default:k(()=>[o(ne,{title:"音频设置"},{default:k(()=>[o(se,null,{default:k(()=>[a("div",Oe,[a("div",De,[a("label",je,[o(n,{icon:"mdi-volume-high",size:"20",class:"me-2"}),l[9]||(l[9]=L(" 音量 ",-1))]),a("div",Ae,[o(M,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=r=>x.value=r),min:"0",max:"100",step:"1","thumb-label":"",color:"purple",class:"volume-slider"},null,8,["modelValue"]),a("span",Ee,_(x.value)+"%",1)])]),a("div",Xe,[a("label",Ce,[o(n,{icon:"mdi-trending-up",size:"20",class:"me-2"}),l[10]||(l[10]=L(" 淡入时长（秒） ",-1))]),a("div",Se,[o(M,{modelValue:D.value,"onUpdate:modelValue":l[3]||(l[3]=r=>D.value=r),min:"0",max:"5",step:"0.1","thumb-label":"",color:"purple"},null,8,["modelValue"]),a("span",Be,_(D.value.toFixed(1))+"s",1)])]),a("div",Fe,[a("label",Ne,[o(n,{icon:"mdi-trending-down",size:"20",class:"me-2"}),l[11]||(l[11]=L(" 淡出时长（秒） ",-1))]),a("div",$e,[o(M,{modelValue:j.value,"onUpdate:modelValue":l[4]||(l[4]=r=>j.value=r),min:"0",max:"5",step:"0.1","thumb-label":"",color:"purple"},null,8,["modelValue"]),a("span",Ie,_(j.value.toFixed(1))+"s",1)])]),a("div",Pe,[a("label",Ge,[o(n,{icon:"mdi-clock-outline",size:"20",class:"me-2"}),l[12]||(l[12]=L(" 音频开始时间 ",-1))]),a("div",We,[o(oe,{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=r=>c.value=r),modelModifiers:{number:!0},type:"number",min:"0",max:d.value-f.value,step:"0.1",variant:"outlined",density:"compact",suffix:"秒","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","max"])])])])]),_:1})]),_:1})]),_:1})])):O("",!0),a("div",He,[o(V,{color:"purple",variant:"flat",size:"large",disabled:!m.value||!p.value||U.value,loading:U.value,class:"action-btn",onClick:ae},{default:k(()=>[o(n,{icon:"mdi-download",class:"me-2"}),L(" "+_(U.value?`处理中 ${R.value}%`:"导出视频"),1)]),_:1},8,["disabled","loading"]),o(V,{variant:"outlined",size:"large",class:"action-btn",onClick:te},{default:k(()=>[o(n,{icon:"mdi-refresh",class:"me-2"}),l[13]||(l[13]=L(" 重置 ",-1))]),_:1})])])]),_:1})}}},Ye=de(qe,[["__scopeId","data-v-46dda5b1"]]);export{Ye as default};
