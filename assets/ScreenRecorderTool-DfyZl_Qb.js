import{T as ne}from"./ToolHeader-CSAKN2xS.js";import{_ as re,e as n,h as ie,f as P,c as A,w as r,r as m,o as p,a,b as t,j as x,i as h,d as v,t as C,F as ce}from"./index-CKlJhNh4.js";const ue={class:"tool-body"},de={key:1,class:"settings-section"},ve={class:"settings-content"},me={class:"setting-item"},pe={class:"setting-label"},fe={class:"setting-item"},ge={class:"setting-label"},_e={class:"setting-controls"},be={class:"setting-item"},he={class:"setting-label"},we={class:"setting-item"},ye={class:"setting-label"},ke={class:"setting-hint"},Se={key:2,class:"preview-section"},Ve={class:"preview-container"},Te=["src"],xe={key:2,class:"preview-placeholder"},Ce={class:"control-section"},Me={key:0,class:"recording-status"},ze={class:"recording-time"},Re={class:"time-text"},Ue={class:"control-buttons"},$e={__name:"ScreenRecorderTool",setup(Ee){const i=n(!1),f=n(!1),w=n(0),y=n(null),M=n([]),I=n(null),_=n(""),z=n(null),R=n(null),U=n(null),$=n("screen"),E=n(!0),F=n(!0),S=n(!1),D=n("webm"),B=n("high"),k=n(!1),u=n(""),b=n(null);let g=null;const W=l=>{const e=Math.floor(l/3600),c=Math.floor(l%3600/60),o=Math.floor(l%60);return e>0?`${String(e).padStart(2,"0")}:${String(c).padStart(2,"0")}:${String(o).padStart(2,"0")}`:`${String(c).padStart(2,"0")}:${String(o).padStart(2,"0")}`},q=()=>!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia?(u.value="您的浏览器不支持屏幕录制功能，请使用 Chrome、Edge 或 Firefox 最新版本。",!1):!0,G=async()=>{try{const l={video:{displaySurface:$.value==="window"?"window":$.value==="tab"?"browser":"monitor",width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:E.value},e=await navigator.mediaDevices.getDisplayMedia(l);return z.value=e,e.getVideoTracks()[0].addEventListener("ended",()=>{i.value&&L()}),e}catch(l){throw console.error("获取屏幕流失败:",l),l.name==="NotAllowedError"?u.value="用户拒绝了屏幕共享权限":u.value=`获取屏幕流失败: ${l.message}`,l}},H=async()=>{try{const l=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"},audio:!1});return R.value=l,l}catch(l){throw console.error("获取摄像头流失败:",l),u.value=`获取摄像头失败: ${l.message}`,l}},Q=async()=>{try{return await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})}catch(l){throw console.error("获取麦克风流失败:",l),u.value=`获取麦克风失败: ${l.message}`,l}},J=async()=>{try{const l=await G(),e=[...l.getVideoTracks()],c=[];if(E.value&&l.getAudioTracks().length>0&&c.push(...l.getAudioTracks()),F.value)try{const s=await Q();c.push(...s.getAudioTracks())}catch(s){console.warn("麦克风获取失败，继续使用屏幕录制:",s)}if(S.value)try{(await H()).getTracks().forEach(V=>V.stop()),console.warn("摄像头功能暂不支持，请使用屏幕录制"),S.value=!1}catch(s){console.warn("摄像头获取失败，继续使用屏幕录制:",s),S.value=!1}const o=new MediaStream([...e,...c]);return U.value=o,o}catch(l){throw console.error("合并流失败:",l),l}},K=async()=>{if(q())try{u.value="",k.value=!0;const l=await J();b.value&&(b.value.srcObject=l,b.value.play());const e=D.value==="webm"?"video/webm;codecs=vp9":"video/mp4",c={mimeType:MediaRecorder.isTypeSupported(e)?e:"video/webm",videoBitsPerSecond:B.value==="high"?8e6:B.value==="medium"?4e6:2e6},o=new MediaRecorder(l,c);y.value=o,M.value=[],o.ondataavailable=s=>{s.data&&s.data.size>0&&M.value.push(s.data)},o.onstop=()=>{const s=new Blob(M.value,{type:o.mimeType});I.value=s,_.value=URL.createObjectURL(s),j()},o.start(1e3),i.value=!0,f.value=!1,w.value=0,k.value=!1,g=setInterval(()=>{w.value++},1e3)}catch(l){console.error("开始录制失败:",l),u.value=`录制失败: ${l.message}`,k.value=!1,j()}},X=()=>{y.value&&(f.value?(y.value.resume(),f.value=!1,g=setInterval(()=>{w.value++},1e3)):(y.value.pause(),f.value=!0,g&&(clearInterval(g),g=null)))},L=()=>{if(!(!y.value||!i.value))try{y.value.stop(),i.value=!1,f.value=!1,g&&(clearInterval(g),g=null),b.value&&(b.value.srcObject=null,b.value.pause()),setTimeout(()=>{j()},500)}catch(l){console.error("停止录制失败:",l),u.value=`停止录制失败: ${l.message}`}},j=()=>{z.value&&(z.value.getTracks().forEach(l=>l.stop()),z.value=null),R.value&&(R.value.getTracks().forEach(l=>l.stop()),R.value=null),U.value&&(U.value.getTracks().forEach(l=>l.stop()),U.value=null)},Y=()=>{if(!I.value)return;const l=D.value==="webm"?"webm":"mp4",e=`screen-recording-${Date.now()}.${l}`,c=_.value,o=document.createElement("a");o.href=c,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o)},O=()=>{i.value&&L(),j(),M.value=[],I.value=null,_.value&&(URL.revokeObjectURL(_.value),_.value=""),w.value=0,u.value="",b.value&&(b.value.srcObject=null)};ie(()=>{O(),g&&clearInterval(g)});const Z=P(()=>f.value?"已暂停":i.value?"录制中":"未开始"),ee=P(()=>f.value?"warning":i.value?"error":"success");return(l,e)=>{const c=m("v-alert"),o=m("v-icon"),s=m("v-radio"),V=m("v-radio-group"),N=m("v-checkbox"),le=m("v-expansion-panel-text"),ae=m("v-expansion-panel"),oe=m("v-expansion-panels"),te=m("v-chip"),T=m("v-btn"),se=m("v-sheet");return p(),A(se,{class:"tool-wrapper",rounded:"xl",elevation:"0"},{default:r(()=>[a(ne,{icon:"mdi-monitor-account",color:"teal",title:"在线录屏",description:"同时录制屏幕、人像与系统/麦克风音频，适合教学演示。"}),t("div",ue,[u.value?(p(),A(c,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4","onClick:close":e[0]||(e[0]=d=>u.value="")},{default:r(()=>[v(C(u.value),1)]),_:1})):x("",!0),i.value?x("",!0):(p(),h("div",de,[a(oe,{variant:"accordion",class:"settings-panels"},{default:r(()=>[a(ae,{title:"录制设置"},{default:r(()=>[a(le,null,{default:r(()=>[t("div",ve,[t("div",me,[t("label",pe,[a(o,{icon:"mdi-monitor",size:"20",class:"me-2"}),e[7]||(e[7]=v(" 录制源 ",-1))]),a(V,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=d=>$.value=d),inline:"","hide-details":""},{default:r(()=>[a(s,{label:"整个屏幕",value:"screen",color:"teal"}),a(s,{label:"应用窗口",value:"window",color:"teal"}),a(s,{label:"浏览器标签",value:"tab",color:"teal"})]),_:1},8,["modelValue"])]),t("div",fe,[t("label",ge,[a(o,{icon:"mdi-volume-high",size:"20",class:"me-2"}),e[8]||(e[8]=v(" 音频选项 ",-1))]),t("div",_e,[a(N,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=d=>E.value=d),label:"系统音频",color:"teal","hide-details":""},null,8,["modelValue"]),a(N,{modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=d=>F.value=d),label:"麦克风",color:"teal","hide-details":""},null,8,["modelValue"]),a(N,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=d=>S.value=d),label:"摄像头",color:"teal","hide-details":""},null,8,["modelValue"])])]),t("div",be,[t("label",he,[a(o,{icon:"mdi-quality-high",size:"20",class:"me-2"}),e[9]||(e[9]=v(" 视频质量 ",-1))]),a(V,{modelValue:B.value,"onUpdate:modelValue":e[5]||(e[5]=d=>B.value=d),inline:"","hide-details":""},{default:r(()=>[a(s,{label:"低",value:"low",color:"teal"}),a(s,{label:"中",value:"medium",color:"teal"}),a(s,{label:"高",value:"high",color:"teal"})]),_:1},8,["modelValue"])]),t("div",we,[t("label",ye,[a(o,{icon:"mdi-file-video",size:"20",class:"me-2"}),e[10]||(e[10]=v(" 输出格式 ",-1))]),a(V,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=d=>D.value=d),inline:"","hide-details":""},{default:r(()=>[a(s,{label:"WebM",value:"webm",color:"teal"}),a(s,{label:"MP4",value:"mp4",color:"teal"})]),_:1},8,["modelValue"]),t("div",ke,[a(o,{icon:"mdi-information",size:"16",class:"me-1"}),e[11]||(e[11]=v(" MP4 格式需要浏览器支持，否则将自动使用 WebM ",-1))])])])]),_:1})]),_:1})]),_:1})])),i.value||_.value?(p(),h("div",Se,[t("div",Ve,[i.value?(p(),h("video",{key:0,ref_key:"previewVideo",ref:b,class:"preview-video",autoplay:"",muted:"",playsinline:""},null,512)):_.value?(p(),h("video",{key:1,src:_.value,class:"preview-video",controls:""},null,8,Te)):(p(),h("div",xe,[a(o,{icon:"mdi-video",size:"64",class:"mb-4"}),e[12]||(e[12]=t("p",null,"录制预览将显示在这里",-1))]))])])):x("",!0),t("div",Ce,[i.value||w.value>0?(p(),h("div",Me,[a(te,{color:ee.value,variant:"flat",size:"large",class:"status-chip"},{default:r(()=>[a(o,{icon:f.value?"mdi-pause-circle":i.value?"mdi-record-circle":"mdi-check-circle",class:"me-2"},null,8,["icon"]),v(" "+C(Z.value),1)]),_:1},8,["color"]),t("div",ze,[a(o,{icon:"mdi-timer-outline",size:"20",class:"me-2"}),t("span",Re,C(W(w.value)),1)])])):x("",!0),t("div",Ue,[i.value?(p(),h(ce,{key:1},[a(T,{color:"warning",variant:"flat",size:"large",class:"control-btn",onClick:X},{default:r(()=>[a(o,{icon:f.value?"mdi-play":"mdi-pause",class:"me-2"},null,8,["icon"]),v(" "+C(f.value?"继续":"暂停"),1)]),_:1}),a(T,{color:"error",variant:"flat",size:"large",class:"control-btn",onClick:L},{default:r(()=>[a(o,{icon:"mdi-stop",class:"me-2"}),e[13]||(e[13]=v(" 停止录制 ",-1))]),_:1})],64)):(p(),A(T,{key:0,color:"teal",variant:"flat",size:"large",loading:k.value,disabled:k.value,class:"control-btn",onClick:K},{default:r(()=>[a(o,{icon:"mdi-record",class:"me-2"}),v(" "+C(k.value?"正在获取权限...":"开始录制"),1)]),_:1},8,["loading","disabled"])),_.value?(p(),A(T,{key:2,color:"success",variant:"flat",size:"large",class:"control-btn",onClick:Y},{default:r(()=>[a(o,{icon:"mdi-download",class:"me-2"}),e[14]||(e[14]=v(" 下载视频 ",-1))]),_:1})):x("",!0),a(T,{variant:"outlined",size:"large",class:"control-btn",onClick:O},{default:r(()=>[a(o,{icon:"mdi-refresh",class:"me-2"}),e[15]||(e[15]=v(" 重置 ",-1))]),_:1})])]),a(c,{type:"info",variant:"tonal",class:"info-alert"},{prepend:r(()=>[a(o,{icon:"mdi-information"})]),default:r(()=>[e[16]||(e[16]=t("div",{class:"info-content"},[t("strong",null,"使用提示："),t("ul",null,[t("li",null,'点击"开始录制"后，浏览器会请求屏幕共享权限'),t("li",null,"选择要录制的屏幕、窗口或标签页"),t("li",null,"录制过程中可以暂停和继续"),t("li",null,"停止录制后可以预览和下载视频"),t("li",null,"建议使用 Chrome、Edge 或 Firefox 浏览器以获得最佳体验")])],-1))]),_:1})])]),_:1})}}},je=re($e,[["__scopeId","data-v-769a2f44"]]);export{je as default};
